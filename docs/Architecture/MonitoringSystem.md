# 监控系统


## 场景：
业务系统和监控系统，两者个独立的项目，各自数据库不能跨项目访问，统一接口交互，设计一套稳定的监控系统

```
    [生产完成]                [添加监控]
    producer                  monitor
                              _ 
           \                  /|
            \                /
             \              /
             _\|           /
              (1)        (2)
               [ RabbitMQ ]              [监控报警]
               [          ](5) <--------  monitor
               [ MsgQueue ]
              (3)        (4)
              _ 
              /|           \
             /              \
            /               _\|
    producer                  monitor
    [删除完成]                [移除监控]
```


## 监控系统功能设计

TODO


## 防御性的设计原则
- 一、消息的顺序问题

消息入队是有序的，如果保证消息被顺序消费，最简单的办法保证只能有一个消费者去消费

- 二、消息的重复问题

1. 消费端处理消息的业务逻辑保持幂等性

2. 保证每条消息都有唯一编号且保证消息处理成功与去重表的日志同时出现

- 三、消息的丢失问题

引入确认机制

- 四、消息的堆积问题

因网络波动，导致消费者断开连接，消息没有被消费，不断堆积，消费者可以单独开启独立连接
