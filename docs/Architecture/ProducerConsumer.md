# 生产消费 Producer Consumer

## 业务应用

生产者、消费者

一般业务场景：生产者生产完消息即可退出；消费者常常需要守护运行，等待接收任务执行

生产者适用短连接，而消费者适用长连接

## 模拟意外

1、开启两个进程、分别使用各自的连接池（一个长连接、一个短连接）

2、意外端口组件服务，重启组件服务

3、分别查看长连接和短连接工作状态（进程均因连接失败而退出）


分析：

长连接：当组件服务断开时，连接池的硬链接失效，长连接对应的进程失败退出，如果没有重试机制，当组件服务恢复时，自身不能自己启动，服务依然失效。

短连接：而短连接的进程会在断开时失败，但其可由外部再次发起，当组件服务恢复时，连接池再次主动维护链接，服务恢复。

所以如果业务中有长连接的场景，需要自行处理**断线重连**

## 处理方式

在 Python 中，处理**断线重连**有多种方式，常见的方式为:

1、Supervisor 守护进程，由 Supervisor 处理进程的状态恢复

2、while 循环，Retry 无限制重试（忽略连接异常不断重试）
