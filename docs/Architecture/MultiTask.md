# 多任务状态同步系统设计

使用观察者模式，通过两组订阅发布实现

以下通过3个进程模拟整体过程：
```
[ pub_req ] ---|   req channel
[ pub_req ] ---| --------------> [ sub_req ] ----> (任务队列)
[ pub_req ] ---|                      |                |
                                      |                |
                                   调度进程 <---     任务进程
                                      |        |       |
[ sub_res ] ---|                      |        |       |
[ sub_res ] ---| <-------------- [ pub_res ]   --- (结果队列)
[ sub_res ] ---|   res channel
```

关键步骤：

调度进程：
1、订阅到第一个请求时，立即将任务插入任务队列，交由任务进程处理
2、然后阻塞获取结果队列
3、读到结果之后立即发布出去
4、发布出去之后立即退出，订阅通道立即断开，后续请求无需接收，这段时间内的请求自然丢弃
