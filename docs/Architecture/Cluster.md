# 集群

## 一致性hash算法与其他算法对比

对于集群中缓存类数据key的节点分配问题，有这几种解决方法，简单的hash取模，槽映射，一致性hash。

- hash取模
对于hash取模，均衡性没有什么问题，但是如果集群中新增一个节点时，将会有`N/(N+1)`的数据实效，当N值越大，失效率越高。这显然是不可接受的。

- 槽映射
redis采用的就是这种算法, 其思想是将key值做一定运算（如crc16， crc32，hash）， 获得一个整数值，再将该值与固定的槽数取模（slots）， 每个节点处理固定的slots。获取key所在的节点时，先要计算出key与槽的对应关系，再通过槽与节点的对应关系找到节点，这里每次新增节点时，只需要迁移一定槽对应的key即可，而不迁移的槽点key值则不会实效，这种方式将失效率降低到了`1/(N+1)`。不过这种方式有个缺点就是所有节点都需要知道槽与节点对应关系，如果client端不保存槽与节点的对应关系的话，它需要实现重定向的逻辑。

- 一致性hash
一致性hash如上文所言，其新增一个节点的失效率仅为`1/(N+1)`，通过一致性hash最大程度的降低了实效率。同时相比于槽映射的方式，不需要引人槽来做中间对应，最大限度的简化了实现。
